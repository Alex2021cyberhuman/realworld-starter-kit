version: '3.4'
services:
  #person-microservice
  person:
    volumes:
      - ./conf/person/appsettings.json:/app/appsettings.json
      - ./conf/person/appsettings.Development.json:/app/appsettings.Development.json
    ports:
      - "3050:80"
    env_file:
      - ./conf/person/dev.env

  #person-storage
  # neo4j:my_password
  person-storage:
    ports:
      - "3051:7474"
      - "3052:7687"
    volumes:
      - ./volumes/person-storage/neo4j/data/:/data/
      - ./volumes/person-storage/neo4j/logs/:/logs/
    env_file:
      - ./conf/person-storage/dev.env

  #auth-microservice
  auth:
    volumes:
      - ./conf/auth/appsettings.json:/app/appsettings.json
      - ./conf/auth/appsettings.Development.json:/app/appsettings.Development.json
    ports:
      - "3060:80"
    env_file:
      - ./conf/person/dev.env

  #auth-storage
  # postgres
  # login postgres:my_password
  auth-storage:
    ports:
      - "3061:5432"
    env_file:
      - ./conf/auth-storage/dev.env
    volumes:
      - ./volumes/auth-storage/postgres/data/:/pg_data/
      - ./volumes/auth-storage/postgres/logs/:/pg_log/
    command: postgres -c logging_collector=on -c log_directory=/pg_log -c log_statement=all -c log_rotation_age=5

  #proxy
  # nginx
  proxy:
    volumes:
      - ./conf/proxy/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - auth
      - person
    ports:
      - "80:80"
    command: nginx -g 'daemon off;'

  #queue
  # rabbitmq
  # login myUser:myPassword
  queue:
    hostname: "queue"
    labels:
      NAME: "queue"
    volumes:
      - ./conf/queue/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf
    ports:
      - "4369:4369"
      - "5671:5671"
      - "5672:5672"
      - "25672:25672"
      - "15671:15671"
      - "15672:15672" # UI
